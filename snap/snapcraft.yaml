name: fclash
base: core22
version: '1.4.0'
summary: A Linux Clash Proxy Fronted based on Clash # 79 char long summary
description: |
  A Linux Clash Proxy Fronted based on Clash. Supports subscriptions, proxies switcher, logger,
  dynamic settings, profile management, auto start with system.

grade: stable
confinement: strict
license: GPL-3.0+

architectures:
  - build-on: amd64
  - build-on: arm64
  # - build-on: armhf
  # - build-on: ppc64el
  # - build-on: s390x

#slots:
#  dbus-fclash:
#    interface: dbus
#    bus: session
#    name: cn.kingtous.fclash

parts:
  fclash:
    plugin: flutter
    build-snaps: [go/1.19/stable]
    source: .
    flutter-target: lib/main.dart
    override-build: |
      ./build-clash-lib.py
      flutter build linux --release -v
    build-packages:
      - libappindicator3-dev
      - libharfbuzz-dev
      # - libgtk-3-dev
      # - libfreetype6-dev
    stage-packages:
      - libappindicator3-1
      - libharfbuzz0b
      # - libgtk-3-0
      # - libgl1-mesa-dri
      # - libfreetype6

plugs:
  gsettings:
  gtk-3-themes:
    interface: content
    target: $SNAP/data-dir/themes
    default-provider: gtk-common-themes
  icon-themes:
    interface: content
    target: $SNAP/data-dir/icons
    default-provider: gtk-common-themes
  sound-themes:
    interface: content
    target: $SNAP/data-dir/sounds
    default-provider: gtk-common-themes

apps:
  fclash:
    command: fclash
    extensions: [ gnome ]
    plugs:
      - network
      - home
      - gsettings
      - desktop
      - desktop-legacy
      - opengl
      - x11
      - wayland
      - unity7
      # manually connect by snap
      - system-observe
      - network-observe
      - network-control
      - network-status
      # end clash subprocess
      - process-control
    #slots:
    #  - dbus-fclash